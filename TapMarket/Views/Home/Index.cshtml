@using Microsoft.AspNetCore.Identity

@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager

@model TapMarket.Models.Home.HomeFormModel

@{
    ViewData["Title"] = "Home Page";

    var shuffledListings = ViewBag.ShuffledListings;
    var customer = ViewBag.Customer;

    var searchedListings = ViewBag.SearchedListings;

    var finalListings = new List<ListingViewModel>();

    bool flag = false;
}

<div class="text-center">
    @if (SignInManager.IsSignedIn(User))
    {
        if (customer is null)
        {
            flag = true;
        }
        else
        {
            <h1> Welcome,  @customer.Username! </h1>
        }
    }
    else
    {
        flag = true;
    }

    @if (flag)
    {
        <h1> Welcome,  Explore Now! </h1>
    }

    <br />
    <form method="post">
        <div class="input-group mb-3">
            <input asp-for="SearchInput" type="text" class="form-control" placeholder="What are you looking for?" aria-label="Search bar" aria-describedby="basic-addon2">
            <div class="input-group-append">
                <input class="btn btn-info float-left" type="submit" value="Search">
            </div>
        </div>
    </form>
</div>


@if (searchedListings == null)
{
    finalListings = shuffledListings;
    <h2 style="margin-top:70px;text-align:center;">Listings</h2>
    <br />

}
else
{
    finalListings = searchedListings;
    if (finalListings.Count < 1)
    {
        <h2 style="margin-top:70px;text-align:center;">No results</h2>
    }
}

<div class="card-deck">
    @foreach (var listing in finalListings)
    {
        <div class="card" style="width: 16rem;">
            <img class="card-img-top" src="@listing.ImageUrl" alt="Listing image">
            <div class="card-body">
                <h5 class="card-title">@listing.Title</h5>
                <p class="card-text"> <b>$@listing.Price </b>- <i>@listing.Condition condition</i></p>
                <a href="/Listing/Details?listingId=@listing.Id" class="btn btn-primary">Check out</a>
            </div>
        </div>
    }
</div>